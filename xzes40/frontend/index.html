<head>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" crossorigin="anonymous"></script>
    <script>
        $(function() {
            var n = 1;
            $("#add").click(function () {
                t = n.toString()
                $("#parameters").append('<div id='+t+'></div>');
                $("#"+t).append('<input name="key" type="text" placeholder="Key">');
                $("#"+t).append('<input name="val" type="text" placeholder="Value">');
                n += 1;
            });

            function processParameters() {
                // Process the parameters sub-field into a JSON object
                // {key1: "value1", key2: "value2", ...}

                // Initialize the parameter object.
                // Initialize the serialized #transformation array.
                var p = {}; var s = $("#transformation").serializeArray();

                for (i=0; i<s.length ; i+=2) {
                    // parameter X.key = parameter X.value
                    p[s[i].value] = s[i+1].value;
                };

                // Return the 
                return p;

            }

            $( "#transformation" ).on( "submit", function( event ) {
                parameters = JSON.stringify(processParameters())
                console.log(parameters);

                event.preventDefault();
            }); 
        });
    </script>
    <style>
        
    </style>
</head>
<body>
    <form enctype="multipart/form-data" action="/cgi-bin/xzes.py" method="post" id="transformation">
        <div>
        <label for="xml">Upload your XML file:</label>
            <input type="file" accept=".xml" name="xml" size="40">
        </div>
        <div>
        <label for="xsl">Upload your XSLT file:</label>
            <input type="file" accept=".xslt" name="xsl" size="40">
        </div>
        <div id="parameters">
        </div>
        <div>
            <input type="button" value="Add a parameter" class="add" id="add" />
            <input type="submit" value="Transform Files" class="submit" id="submit" />
        </div>
    </form>
</body>
